<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Sotpal</title>
  <style>
    :root {
      --bg: #0f1220;
      --panel: #171a2b;
      --panel-2: #1d2136;
      --accent: #7c9cff;
      --accent-2: #a8ffcf;
      --text: #e8ebff;
      --muted: #9aa3c7;
      --danger: #ff6b6b;
      --success: #43d9a3;
      --radius: 16px;
      --shadow: 0 10px 30px rgba(0,0,0,.35);
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, "Noto Sans", "Helvetica Neue", Arial, "Apple Color Emoji", "Segoe UI Emoji";
      background: radial-gradient(1200px 700px at 70% -10%, #1b2246 0%, var(--bg) 42%), var(--bg);
      color: var(--text);
      display: grid;
      place-items: center;
      padding: 24px;
    }

    .app {
      width: min(900px, 100%);
      background: linear-gradient(180deg, var(--panel) 0%, var(--panel-2) 100%);
      border: 1px solid rgba(255,255,255,.06);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: clamp(18px, 3vw, 28px);
    }

    h1, h2, h3, p { margin: 0 0 10px; }
    h1 { font-size: clamp(28px, 3.5vw, 40px); letter-spacing: .5px; }
    h2 { font-size: clamp(20px, 2.6vw, 28px); color: var(--accent); }
    p.muted { color: var(--muted); margin-bottom: 18px; }

    .stack { display: grid; gap: 16px; }

    .panel {
      background: rgba(255,255,255,.03);
      border: 1px solid rgba(255,255,255,.06);
      border-radius: var(--radius);
      padding: 16px;
    }

    .controls { display: grid; gap: 12px; }

    .row {
      display: grid;
      grid-template-columns: 1fr auto;
      align-items: center;
      gap: 12px;
    }

    label { color: var(--muted); font-weight: 600; font-size: 14px; }

    input[type="range"] { width: 100%; }

    .value-badge {
      background: #0b0f21;
      border: 1px solid rgba(255,255,255,.08);
      color: var(--accent-2);
      padding: 8px 12px;
      border-radius: 999px;
      font-weight: 700;
      font-variant-numeric: tabular-nums;
      min-width: 64px;
      text-align: center;
    }

    .btn {
      appearance: none; border: 0; cursor: pointer; user-select: none;
      display: inline-flex; align-items: center; justify-content: center;
      gap: 8px; font-weight: 700; letter-spacing: .3px;
      padding: 12px 18px; border-radius: 14px; text-decoration: none;
      transition: transform .06s ease, box-shadow .2s ease, background .2s ease, opacity .2s ease;
    }

    .btn:active { transform: translateY(1px); }

    .btn-primary { background: var(--accent); color: #0d1330; box-shadow: 0 8px 20px rgba(124,156,255,.35); }
    .btn-primary:hover { filter: brightness(1.05); }

    .btn-ghost { background: transparent; color: var(--text); border: 1px solid rgba(255,255,255,.14); }
    .btn-ghost:hover { background: rgba(255,255,255,.06); }

    .btn-danger { background: var(--danger); color: white; }

    .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
    @media (max-width: 560px) { .grid-2 { grid-template-columns: 1fr; } }

    .input {
      width: 100%; padding: 14px 16px; border-radius: 12px; font-size: 16px;
      background: #0c1024; color: var(--text);
      border: 1px solid rgba(255,255,255,.12);
      outline: none; transition: border .2s ease, box-shadow .2s ease;
    }
    .input:focus { border-color: var(--accent); box-shadow: 0 0 0 4px rgba(124,156,255,.18); }

    .center { text-align: center; }
    .spacer { height: 8px; }

    .footer { display: flex; justify-content: center; gap: 12px; margin-top: 16px; }

    .chip {
      display: inline-flex; align-items: center; gap: 8px;
      background: #0b0f21; border: 1px solid rgba(255,255,255,.1);
      color: var(--muted); padding: 8px 12px; border-radius: 999px;
      font-size: 14px; font-weight: 600;
    }

    .hidden { display: none !important; }
    .fade { animation: fade .2s ease; }
    @keyframes fade { from { opacity: 0; transform: translateY(2px); } to { opacity: 1; transform: none; } }

    .divider { height: 1px; background: rgba(255,255,255,.08); margin: 8px 0 12px; }

    .topic-preview { font-size: clamp(20px, 2.5vw, 28px); line-height: 1.3; }
  </style>
</head>
<body>
  <main class="app">
    <!-- HOME VIEW -->
    <section id="view-home" class="stack fade">
      <h1>SOTPAL</h1>
      <p class="muted">A quick party game of confident bluffing. One guesser, the rest are convincers. Submit topics, reveal one at random, then grill away.</p>

      <div class="panel stack">
        <div class="row">
          <div class="stack">
            <label for="players">Number of players (3â€“20)</label>
            <input id="players" type="range" min="3" max="20" value="5" aria-label="Number of players" />
          </div>
          <div class="value-badge" id="players-val">5</div>
        </div>
        <div class="divider"></div>
        <button id="btn-play" class="btn btn-primary" style="width: 160px;">Play</button>
      </div>
    </section>

    <!-- ENTER TOPIC VIEW -->
    <section id="view-enter" class="stack hidden fade" aria-live="polite">
      <h2>Enter Your Topic</h2>
      <form id="topic-form" class="stack" autocomplete="off">
        <input id="topic-input" class="input" type="text" placeholder="Type a random, obscure topic..." maxlength="160" />
        <div class="grid-2">
          <button class="btn btn-primary" type="submit">Submit Topic</button>
          <button class="btn btn-ghost" type="button" id="btn-clear">Clear</button>
        </div>
      </form>
    </section>

    <!-- REVEAL VIEW -->
    <section id="view-reveal" class="stack hidden fade center">
      <h2>The Chosen Topic is</h2>
      <div class="spacer"></div>
      <div id="chosen-topic" class="panel topic-preview"></div>
      <div class="footer">
        <button id="btn-next" class="btn btn-ghost">Next Round</button>
        <button id="btn-end" class="btn btn-primary">End</button>
      </div>
    </section>
  </main>

  <script>
    // --- State ---
    const views = {
      home: document.getElementById('view-home'),
      enter: document.getElementById('view-enter'),
      reveal: document.getElementById('view-reveal'),
    };

    const playersRange = document.getElementById('players');
    const playersVal = document.getElementById('players-val');
    const btnPlay = document.getElementById('btn-play');

    const form = document.getElementById('topic-form');
    const input = document.getElementById('topic-input');
    const btnClear = document.getElementById('btn-clear');
    const counter = document.getElementById('topic-counter');

    const chosenEl = document.getElementById('chosen-topic');
    const btnNext = document.getElementById('btn-next');
    const btnEnd = document.getElementById('btn-end');

    let nPlayers = 5;
    let topics = [];
    let targetCount = nPlayers - 1; // topics needed per round

    function show(view) {
      for (const key in views) views[key].classList.add('hidden');
      views[view].classList.remove('hidden');
      // focus management
      if (view === 'enter') setTimeout(() => input.focus(), 0);
    }

    function updatePlayers(val) {
      nPlayers = Number(val);
      playersVal.textContent = String(nPlayers);
      targetCount = Math.max(2, nPlayers - 1); // n>=3 -> at least 2 topics
      updateCounter();
    }

    function updateCounter() {
      const nextIndex = Math.min(topics.length + 1, targetCount);
      counter.textContent = `Topic ${nextIndex} of ${targetCount}`;
    }

    function resetRound(keepPlayers = true) {
      topics = [];
      if (!keepPlayers) {
        updatePlayers(5);
        playersRange.value = '5';
      }
      updateCounter();
      input.value = '';
    }

    function randInt(max) { return Math.floor(Math.random() * max); }

    // --- Event wiring ---
    playersRange.addEventListener('input', (e) => updatePlayers(e.target.value));

    btnPlay.addEventListener('click', () => {
      targetCount = Math.max(2, Number(playersRange.value) - 1);
      nPlayers = Number(playersRange.value);
      resetRound(true);
      updateCounter();
      show('enter');
    });

    btnClear.addEventListener('click', () => { input.value = ''; input.focus(); });

    form.addEventListener('submit', (e) => {
      e.preventDefault();
      const text = input.value.trim();
      if (!text) { input.focus(); return; }
      topics.push(text);
      input.value = '';

      if (topics.length >= targetCount) {
        // reveal
        const chosen = topics[randInt(topics.length)];
        chosenEl.textContent = chosen;
        show('reveal');
      } else {
        updateCounter();
        input.focus();
      }
    });

    btnNext.addEventListener('click', () => {
      // keep same player count; start new round
      resetRound(true);
      updateCounter();
      show('enter');
    });

    btnEnd.addEventListener('click', () => {
      // reset everything
      resetRound(false);
      show('home');
    });

    // init
    updatePlayers(playersRange.value);
  </script>
</body>
</html>
